<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>チーム分けツール</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1em;
      max-width: 600px;
      margin: auto;
    }
    input, button {
      margin: 5px 0;
      padding: 0.5em;
      font-size: 1em;
      width: 100%;
      box-sizing: border-box;
    }
    ul {
      padding-left: 1.2em;
    }
    h1, h2 {
      font-size: 1.2em;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ランダムチーム分け（保存・固定・編集対応）</h1>

  <h2>設定</h2>
  チーム1名: <input type="text" id="team1Name" value="東">
  人数: <input type="number" id="team1Size" value="3" min="1"><br>
  チーム2名: <input type="text" id="team2Name" value="西">
  人数: <input type="number" id="team2Size" value="3" min="1"><br>

  固定メンバー（常にチーム1）: <input type="text" id="fixedName">
  <button onclick="addFixedName()">追加</button>
  <ul id="fixedList"></ul>

  <h2>名前追加</h2>
  <input type="text" id="nameInput" placeholder="名前を入力">
  <button onclick="addName()">追加</button>
  <button onclick="clearNames()">全削除</button>
  <ul id="nameList"></ul>

  <button onclick="shuffleAndDisplay()">チーム分けする</button>

  <h2 id="team1Header">東チーム</h2>
  <ul id="team1"></ul>

  <h2 id="team2Header">西チーム</h2>
  <ul id="team2"></ul>

  <h2>観戦</h2>
  <ul id="spectators"></ul>

  <script>
    function getSavedNames() {
      const saved = localStorage.getItem("names");
      return saved ? JSON.parse(saved) : [];
    }

    function saveNames(names) {
      localStorage.setItem("names", JSON.stringify(names));
    }

    function getFixedNames() {
      const saved = localStorage.getItem("fixedNames");
      return saved ? JSON.parse(saved) : [];
    }

    function saveFixedNames(names) {
      localStorage.setItem("fixedNames", JSON.stringify(names));
    }

    function renderNames() {
      const names = getSavedNames();
      const list = document.getElementById("nameList");
      list.innerHTML = names.map((name, index) => `<li>${name} <button onclick=\"removeName(${index})\">削除</button></li>`).join('');
    }

    function renderFixedNames() {
      const fixed = getFixedNames();
      const list = document.getElementById("fixedList");
      list.innerHTML = fixed.map((name, index) => `<li>${name} <button onclick=\"removeFixedName(${index})\">削除</button></li>`).join('');
    }

    function addName() {
      const input = document.getElementById("nameInput");
      const name = input.value.trim();
      if (name) {
        const names = getSavedNames();
        names.push(name);
        saveNames(names);
        renderNames();
        input.value = "";
      }
    }

    function removeName(index) {
      const names = getSavedNames();
      names.splice(index, 1);
      saveNames(names);
      renderNames();
    }

    function clearNames() {
      localStorage.removeItem("names");
      renderNames();
    }

    function addFixedName() {
      const input = document.getElementById("fixedName");
      const name = input.value.trim();
      if (name) {
        const fixed = getFixedNames();
        fixed.push(name);
        saveFixedNames(fixed);
        renderFixedNames();
        input.value = "";
      }
    }

    function removeFixedName(index) {
      const fixed = getFixedNames();
      fixed.splice(index, 1);
      saveFixedNames(fixed);
      renderFixedNames();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function shuffleAndDisplay() {
      const team1Name = document.getElementById("team1Name").value || "チーム1";
      const team2Name = document.getElementById("team2Name").value || "チーム2";
      const team1Size = parseInt(document.getElementById("team1Size").value);
      const team2Size = parseInt(document.getElementById("team2Size").value);

      const all = getSavedNames();
      const fixed = getFixedNames();

      // 固定されたメンバーは team1 に先に入れる
      const rest = all.filter(name => !fixed.includes(name));
      shuffle(rest);

      const team1 = [...fixed];
      const remainingForTeam1 = team1Size - team1.length;
      team1.push(...rest.splice(0, remainingForTeam1));

      const team2 = rest.splice(0, team2Size);
      const spectators = rest;

      document.getElementById("team1Header").innerText = team1Name;
      document.getElementById("team2Header").innerText = team2Name;

      document.getElementById("team1").innerHTML = team1.map(name => `<li>${name}</li>`).join('');
      document.getElementById("team2").innerHTML = team2.map(name => `<li>${name}</li>`).join('');
      document.getElementById("spectators").innerHTML = spectators.map(name => `<li>${name}</li>`).join('');
    }

    renderNames();
    renderFixedNames();
  </script>
</body>
</html>
