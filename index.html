<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チーム分けツール</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 1em;
            max-width: 600px;
            margin: auto;
        }

        input, button, select {
            margin: 5px 0;
            padding: 0.5em;
            font-size: 1em;
            width: 100%;
            box-sizing: border-box;
        }

        ul {
            padding-left: 1.2em;
        }

        h1, h2, h3 {
            font-size: 1.2em;
        }

        button {
            cursor: pointer;
        }

        .section {
            margin-top: 1em;
        }
    </style>
</head>
<body>
    <h1>ドッヂボール地獄カスタム用</h1>

    <div class="section">
        <h2>設定</h2>
        チーム1の名前: <input type="text" id="team1Name" value="東">
        人数: <input type="number" id="team1Size" value="3" min="1"><br>
        チーム2の名前: <input type="text" id="team2Name" value="西">
        人数: <input type="number" id="team2Size" value="3" min="1">
    </div>

    <div class="section">
        <h2>メンバー管理</h2>
        <input type="text" id="newMember" placeholder="名前を入力">
        <button onclick="addMember()">メンバー追加</button>
        <ul id="allMembers"></ul>
    </div>

    <div class="section">
        <h2>絶対にやらないといけない人</h2>
        <select id="fixedSelector"></select>
        <button onclick="addFixedName(1)">チーム1に固定</button>
        <button onclick="addFixedName(2)">チーム2に固定</button>
        <h3>チーム1に固定:</h3>
        <ul id="fixedList1"></ul>
        <h3>チーム2に固定:</h3>
        <ul id="fixedList2"></ul>
    </div>

    <div class="section">
        <h2>抽選対象メンバー</h2>
        <ul id="nameList"></ul>
    </div>

    <button onclick="shuffleAndDisplay()">チーム分けする</button>

    <h2 id="team1Header">東チーム</h2>
    <ul id="team1"></ul>

    <h2 id="team2Header">西チーム</h2>
    <ul id="team2"></ul>

    <h2>観戦</h2>
    <ul id="spectators"></ul>

    <script>
        const defaultNames = [
            "Alastor", "Jack", "IVE", "あんな", "うらら", "おおばん", "おぱん", "かなもと", "かまちゃん", "さとめぐ",
            "みゆゅ", "ゆかいもん", "ゆめ", "ゆらみそ", "ゆりこ", "りにゃ", "正気"
        ];

        function initData() {
            if (!localStorage.getItem("names")) {
                localStorage.setItem("names", JSON.stringify(defaultNames));
            }
            if (!localStorage.getItem("fixed1")) {
                localStorage.setItem("fixed1", JSON.stringify([]));
            }
            if (!localStorage.getItem("fixed2")) {
                localStorage.setItem("fixed2", JSON.stringify([]));
            }
        }

        function getNames() {
            return JSON.parse(localStorage.getItem("names")) || [];
        }

        function saveNames(names) {
            localStorage.setItem("names", JSON.stringify(names));
        }

        function getFixed(team) {
            return JSON.parse(localStorage.getItem("fixed" + team)) || [];
        }

        function saveFixed(team, list) {
            localStorage.setItem("fixed" + team, JSON.stringify(list));
        }

        function updateSelectors() {
            const all = getNames();
            const fixed1 = getFixed(1);
            const fixed2 = getFixed(2);
            const available = all.filter(name => !fixed1.includes(name) && !fixed2.includes(name));

            const selector = document.getElementById("fixedSelector");
            selector.innerHTML = available.map(name => `<option value="${name}">${name}</option>`).join('');
        }

        function renderFixedLists() {
            const list1 = getFixed(1);
            const list2 = getFixed(2);
            const ul1 = document.getElementById("fixedList1");
            const ul2 = document.getElementById("fixedList2");

            ul1.innerHTML = list1.map((name, i) => `<li>${name} <button onclick="removeFixed(${i}, 1)">削除</button></li>`).join('');
            ul2.innerHTML = list2.map((name, i) => `<li>${name} <button onclick="removeFixed(${i}, 2)">削除</button></li>`).join('');
        }

        function renderNameList() {
            const all = getNames();
            const fixed1 = getFixed(1);
            const fixed2 = getFixed(2);
            const randomList = all.filter(name => !fixed1.includes(name) && !fixed2.includes(name));
            const list = document.getElementById("nameList");
            list.innerHTML = randomList.map(name => `<li>${name}</li>`).join('');
        }

        function renderAllMembers() {
            const names = getNames();
            const ul = document.getElementById("allMembers");
            ul.innerHTML = names.map((name, i) => `<li>${name} <button onclick="removeMember(${i})">削除</button></li>`).join('');
            updateSelectors();
            renderNameList();
        }

        function addMember() {
            const input = document.getElementById("newMember");
            const name = input.value.trim();
            if (name) {
                const names = getNames();
                if (!names.includes(name)) {
                    names.push(name);
                    saveNames(names);
                    input.value = "";
                    renderAllMembers();
                }
            }
        }

        function removeMember(index) {
            const names = getNames();
            const fixed1 = getFixed(1);
            const fixed2 = getFixed(2);
            const name = names[index];

            // 固定に含まれていたら削除
            if (fixed1.includes(name)) {
                fixed1.splice(fixed1.indexOf(name), 1);
                saveFixed(1, fixed1);
            }
            if (fixed2.includes(name)) {
                fixed2.splice(fixed2.indexOf(name), 1);
                saveFixed(2, fixed2);
            }

            names.splice(index, 1);
            saveNames(names);
            renderAllMembers();
        }

        function addFixedName(team) {
            const selector = document.getElementById("fixedSelector");
            const name = selector.value;
            if (!name) return;
            const fixed = getFixed(team);
            fixed.push(name);
            saveFixed(team, fixed);
            updateSelectors();
            renderFixedLists();
            renderNameList();
            renderAllMembers();
        }

        function removeFixed(index, team) {
            const fixed = getFixed(team);
            fixed.splice(index, 1);
            saveFixed(team, fixed);
            updateSelectors();
            renderFixedLists();
            renderNameList();
            renderAllMembers();
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function shuffleAndDisplay() {
            const team1Name = document.getElementById("team1Name").value || "チーム1";
            const team2Name = document.getElementById("team2Name").value || "チーム2";
            const team1Size = parseInt(document.getElementById("team1Size").value);
            const team2Size = parseInt(document.getElementById("team2Size").value);

            const all = getNames();
            const fixed1 = getFixed(1);
            const fixed2 = getFixed(2);
            const pool = all.filter(name => !fixed1.includes(name) && !fixed2.includes(name));

            shuffle(pool);

            const team1 = [...fixed1, ...pool.splice(0, team1Size - fixed1.length)];
            const team2 = [...fixed2, ...pool.splice(0, team2Size - fixed2.length)];
            const spectators = pool;

            document.getElementById("team1Header").innerText = team1Name;
            document.getElementById("team2Header").innerText = team2Name;

            document.getElementById("team1").innerHTML = team1.map(name => `<li>${name}</li>`).join('');
            document.getElementById("team2").innerHTML = team2.map(name => `<li>${name}</li>`).join('');
            document.getElementById("spectators").innerHTML = spectators.map(name => `<li>${name}</li>`).join('');
        }

        // 初期化
        initData();
        renderAllMembers();
        renderFixedLists();
    </script>
</body>
</html>
