<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チーム分けツール</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 1em;
            max-width: 600px;
            margin: auto;
        }

        input, button, select {
            margin: 5px 0;
            padding: 0.5em;
            font-size: 1em;
            width: 100%;
            box-sizing: border-box;
        }

        ul {
            padding-left: 1.2em;
        }

        h1, h2, h3 {
            font-size: 1.2em;
        }

        button {
            cursor: pointer;
        }

        .section {
            margin-top: 1em;
        }
    </style>
</head>
<body>
    <h1>ランダムチーム分け（メンバー・抽選分離対応）</h1>

    <div class="section">
        <h2>設定</h2>
        チーム1名: <input type="text" id="team1Name" value="東">
        人数: <input type="number" id="team1Size" value="3" min="1"><br>
        チーム2名: <input type="text" id="team2Name" value="西">
        人数: <input type="number" id="team2Size" value="3" min="1">
    </div>

    <div class="section">
        <h2>メンバー管理</h2>
        <input type="text" id="newMember" placeholder="名前を入力">
        <button onclick="addMember()">メンバー追加</button>
        <ul id="allMembers"></ul>
    </div>

    <div class="section">
        <h2>抽選メンバー管理</h2>
        <select id="selectForDraw"></select>
        <button onclick="addToDrawPool()">抽選メンバーに追加</button>
        <ul id="drawList"></ul>
    </div>

    <div class="section">
        <h2>固定メンバー</h2>
        <select id="fixedSelector"></select>
        <button onclick="addFixedName(1)">チーム1に固定</button>
        <button onclick="addFixedName(2)">チーム2に固定</button>
        <h3>チーム1固定:</h3>
        <ul id="fixedList1"></ul>
        <h3>チーム2固定:</h3>
        <ul id="fixedList2"></ul>
    </div>

    <button onclick="shuffleAndDisplay()">チーム分けする</button>

    <h2 id="team1Header">東チーム</h2>
    <ul id="team1"></ul>

    <h2 id="team2Header">西チーム</h2>
    <ul id="team2"></ul>

    <h2>観戦</h2>
    <ul id="spectators"></ul>

    <script>
        const defaultNames = [
            "Alastor", "Jack", "IVE", "あんな", "うらら", "おおばん", "おぱん", "かなもと", "かまちゃん", "さとめぐ",
            "みゆゅ", "ゆかいもん", "ゆめ", "ゆらみそ", "ゆりこ", "りにゃ", "正気"
        ];

        function initData() {
            if (!localStorage.getItem("members")) {
                localStorage.setItem("members", JSON.stringify(defaultNames));
            }
            if (!localStorage.getItem("drawPool")) {
                localStorage.setItem("drawPool", JSON.stringify([]));
            }
            if (!localStorage.getItem("fixed1")) {
                localStorage.setItem("fixed1", JSON.stringify([]));
            }
            if (!localStorage.getItem("fixed2")) {
                localStorage.setItem("fixed2", JSON.stringify([]));
            }
        }

        function getMembers() {
            return JSON.parse(localStorage.getItem("members")) || [];
        }
        function saveMembers(members) {
            localStorage.setItem("members", JSON.stringify(members));
        }

        function getDrawPool() {
            return JSON.parse(localStorage.getItem("drawPool")) || [];
        }
        function saveDrawPool(pool) {
            localStorage.setItem("drawPool", JSON.stringify(pool));
        }

        function getFixed(team) {
            return JSON.parse(localStorage.getItem("fixed" + team)) || [];
        }
        function saveFixed(team, list) {
            localStorage.setItem("fixed" + team, JSON.stringify(list));
        }

        function renderAllMembers() {
            const members = getMembers();
            const ul = document.getElementById("allMembers");
            ul.innerHTML = members.map((name, i) => `<li>${name} <button onclick="removeMember(${i})">削除</button></li>`).join('');
            updateSelectors();
        }

        function renderDrawList() {
            const list = getDrawPool();
            const ul = document.getElementById("drawList");
            ul.innerHTML = list.map((name, i) => `<li>${name} <button onclick="removeFromDrawPool(${i})">抽選から外す</button></li>`).join('');
        }

        function updateSelectors() {
            const all = getMembers();
            const fixed1 = getFixed(1);
            const fixed2 = getFixed(2);
            const draw = getDrawPool();

            const available = all.filter(name => !fixed1.includes(name) && !fixed2.includes(name));
            const drawable = all.filter(name => !draw.includes(name));

            document.getElementById("fixedSelector").innerHTML = available.map(name => `<option value="${name}">${name}</option>`).join('');
            document.getElementById("selectForDraw").innerHTML = drawable.map(name => `<option value="${name}">${name}</option>`).join('');
        }

        function addMember() {
            const input = document.getElementById("newMember");
            const name = input.value.trim();
            if (!name) return;
            const members = getMembers();
            if (!members.includes(name)) {
                members.push(name);
                saveMembers(members);
                input.value = "";
                renderAllMembers();
                updateSelectors();
            }
        }

        function removeMember(index) {
            const members = getMembers();
            members.splice(index, 1);
            saveMembers(members);
            const drawPool = getDrawPool().filter(name => members.includes(name));
            saveDrawPool(drawPool);
            renderAllMembers();
            renderDrawList();
            updateSelectors();
        }

        function addToDrawPool() {
            const selector = document.getElementById("selectForDraw");
            const name = selector.value;
            if (!name) return;
            const draw = getDrawPool();
            if (!draw.includes(name)) {
                draw.push(name);
                saveDrawPool(draw);
                renderDrawList();
                updateSelectors();
            }
        }

        function removeFromDrawPool(index) {
            const draw = getDrawPool();
            draw.splice(index, 1);
            saveDrawPool(draw);
            renderDrawList();
            updateSelectors();
        }

        function addFixedName(team) {
            const selector = document.getElementById("fixedSelector");
            const name = selector.value;
            if (!name) return;
            const fixed = getFixed(team);
            if (!fixed.includes(name)) {
                fixed.push(name);
                saveFixed(team, fixed);
                updateSelectors();
                renderFixedLists();
            }
        }

        function removeFixed(index, team) {
            const fixed = getFixed(team);
            fixed.splice(index, 1);
            saveFixed(team, fixed);
            updateSelectors();
            renderFixedLists();
        }

        function renderFixedLists() {
            const list1 = getFixed(1);
            const list2 = getFixed(2);
            document.getElementById("fixedList1").innerHTML = list1.map((name, i) => `<li>${name} <button onclick="removeFixed(${i}, 1)">削除</button></li>`).join('');
            document.getElementById("fixedList2").innerHTML = list2.map((name, i) => `<li>${name} <button onclick="removeFixed(${i}, 2)">削除</button></li>`).join('');
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function shuffleAndDisplay() {
            const team1Name = document.getElementById("team1Name").value || "チーム1";
            const team2Name = document.getElementById("team2Name").value || "チーム2";
            const team1Size = parseInt(document.getElementById("team1Size").value);
            const team2Size = parseInt(document.getElementById("team2Size").value);

            const fixed1 = getFixed(1);
            const fixed2 = getFixed(2);
            const pool = getDrawPool().filter(name => !fixed1.includes(name) && !fixed2.includes(name));

            shuffle(pool);

            const team1 = [...fixed1, ...pool.splice(0, team1Size - fixed1.length)];
            const team2 = [...fixed2, ...pool.splice(0, team2Size - fixed2.length)];
            const spectators = pool;

            document.getElementById("team1Header").innerText = team1Name;
            document.getElementById("team2Header").innerText = team2Name;

            document.getElementById("team1").innerHTML = team1.map(name => `<li>${name}</li>`).join('');
            document.getElementById("team2").innerHTML = team2.map(name => `<li>${name}</li>`).join('');
            document.getElementById("spectators").innerHTML = spectators.map(name => `<li>${name}</li>`).join('');
        }

        initData();
        renderAllMembers();
        renderDrawList();
        renderFixedLists();
    </script>
</body>
</html>
